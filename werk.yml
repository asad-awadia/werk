version: "1"

description: "Manage Werk with Werk"

jobs:
  main:
    description: "Build application"
    commands:
      - shards build
    needs:
      - lint
      - test

  lint:
    description: "Lint code"
    commands:
      - ameba
    can_fail: true

  test:
    description: "Test code"
    commands:
      - crystal spec

  deps:
    description: "Install dependencies"
    commands:
      - brew install libssh2
      - shards install

  docs:
    description: Generate API documentation
    commands:
      - crystal docs
      - open docs/index.html

  install:
    description: Install Werk locally
    commands:
      - echo "Installing locally..."
      - sudo cp -v ./bin/werk /usr/local/bin
    needs:
      - main

  uninstall:
    description: Uninstall Werk locally
    variables:
      APP: /usr/local/bin/werk
    commands:
      - '[[ -f "${APP}" ]] && sudo rm -vf "${APP}" || echo "Werk is not installed!"'

  env:
    commands:
      - export
